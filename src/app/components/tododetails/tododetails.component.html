<div id="full-cover-background"
  class="mx-2 md:mx-8 lg:mx-16 rounded-[40px] border border-gray-200 bg-white p-4 md:p-6 text-sm mt-20 flex justify-center">

  <div *ngIf="todoForm" id="centered-block" class="w-full max-w-3xl"> <!-- ⬅️ max largeur -->

    <!-- Header -->
    <mat-card-header class="w-full flex justify-center mb-15">
      <h2 class="text-center text-xl font-semibold text-gray-500">
        {{ todo.title }}
      </h2>
    </mat-card-header>

    <!-- Form -->
    <mat-card-content>
      <form [formGroup]="todoForm" (ngSubmit)="onSubmitTodo()">

        <!-- 2 colonnes -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">

          <!-- COLONNE GAUCHE -->
          <div class="space-y-3">

            <!-- Utilisateur -->
            <mat-form-field class="w-full" appearance="outline">
              <input matInput [value]="todo.surname + ' ' + todo.name" readonly />
            </mat-form-field>

            <!-- Membre -->
            <mat-form-field class="w-full" appearance="outline">
              <mat-label>Membre associé</mat-label>
              <mat-chip-grid #chipGrid aria-label="Membre sélection">
                @for (contact of selectedContacts; track contact.id) {
                <mat-chip-row (removed)="remove(contact)" class="!bg-emerald-200 !text-black !text-xs">
                  {{ contact.nom }} {{ contact.prenom }}
                  <button matChipRemove>
                    <mat-icon>cancel</mat-icon>
                  </button>
                </mat-chip-row>
                }
              </mat-chip-grid>
              <input [formControl]="currentContact" [matChipInputFor]="chipGrid" [matAutocomplete]="auto" />
              <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
                @for (contact of filteredContacts; track contact.id) {
                <mat-option [value]="contact">
                  {{ contact.nom }} {{ contact.prenom }}
                </mat-option>
                }
              </mat-autocomplete>
            </mat-form-field>

            <!-- Projet -->
            <mat-form-field class="w-full" appearance="outline">
              <mat-label>Projet associé</mat-label>
              <mat-select formControlName="projet">
                <mat-option *ngFor="let projet of allProjets" [value]="projet.id">
                  {{ projet.title }}
                </mat-option>
              </mat-select>
            </mat-form-field>

          </div>

          <!-- COLONNE DROITE -->
          <div class="space-y-3">

            <!-- Titre -->
            <mat-form-field class="w-full" appearance="outline">
              <mat-label>Tâche</mat-label>
              <input matInput formControlName="title" type="text" placeholder="Nom de la tâche" />
            </mat-form-field>

            <!-- Description -->
            <mat-form-field class="w-full" appearance="outline">
              <mat-label>Description</mat-label>
              <textarea matInput formControlName="textarea" rows=""></textarea>
            </mat-form-field>

            <!-- Priorité + Échéance -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <mat-form-field appearance="outline">
                <mat-label>Priorité</mat-label>
                <mat-select formControlName="priorite">
                  @for (priorite of listPriorite; track priorite.number) {
                  <mat-option [value]="priorite.number">{{ priorite.number }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="custom-datepicker">
                <mat-label>Échéance</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="dueDate" />
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
            </div>

          </div>

        </div>

            <!-- Complété -->
            <div class="flex items-center justify-center gap-3 mt-4">
              <mat-checkbox formControlName="completed"></mat-checkbox>
              <span class="text-gray-600">Marquer comme terminé</span>
            </div>

       

        <!-- Boutons -->
        <div class="flex justify-center gap-6 mt-15">
          <!-- Enregistrer : vert clair -->
          <button mat-raised-button type="submit"
            class="px-6 py-2 rounded-lg !bg-emerald-200 text-black hover:!bg-emerald-300">
            Enregistrer
          </button>

          <!-- Annuler : gris clair -->
          <button mat-stroked-button (click)="onCancel()"
            class="px-6 py-2 rounded-lg border !border-gray-300 !text-gray-700 hover:!bg-gray-100">
            <mat-icon>arrow_back</mat-icon> Annuler
          </button>

          <!-- Supprimer : rouge clair -->
          <button mat-stroked-button (click)="onDelete(todo.id)"
            class="px-6 py-2 rounded-lg border !border-red-200 !text-red-600 hover:!bg-red-200 hover:!text-red-800">
           Supprimer
          </button>
        </div>

      </form>
    </mat-card-content>

  </div>
</div>